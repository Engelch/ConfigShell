#!/usr/bin/env bash

_debug=true
[ "$1" = '-V' ] && echo v2.0 && exit 0
[ "$1" = '--version' ] && echo v2.0 && exit 0
[ "$1" = '-D' ] && _debug=echo && shift

[ -z "$KUBECTL" ] && echo >&2 "KUBECTL environment variable is not set, exiting" && exit 1

for arg in $* ; do
  if [[ $arg =~ ^-.* ]] ; then
    inArg="$inArg $arg"
    $_debug inArg extended by $arg
    shift
  else
    restArgs="$*"
    echo restArgs set to $restArgs
    break
  fi
done

[ -z "$restArgs" ] && $KUBECTL get pods -o wide --show-labels $inArg
[ -n "$restArgs" ] && $KUBECTL get pods -o wide --show-labels $inArg | grep -E $restArgs
