#!/usr/bin/env bash
# shellcheck disable=SC2155

# show fingerprint of public RSA key
function rsaPubFingerprint2() {
       openssl rsa -modulus -text -noout -pubin -in "$1"  | \
        grep -E '^(Modulus=|Exponent:)' | sed -E 's/Exponent: [0-9]+ \(//' | \
        sed 's/)//' | sed 's/Modulus=//' | sed 's/0x//' | \
        tr  '\n' ',' | sed -E 's/.$//' | \
        sha256sum | \
        awk '{ print $1 }'
}

function err() { 1>&2 echo "$@"; }

function usage() {
   err calculate the fingerprint of a public RSA key

   err $(basename "$0") "[ -v ]"
   err
   err '-v ::= show the filename'
}

unset VERBOSE
if [ "$1" = -h ] ; then
   usage
   exit 1
elif [ "$1" = -v ] ; then
   VERBOSE=TRUE
   shift
fi
for file in "$@" ; do
   [ ! -f "$file" ] && err ERROR "$file" is not a regualar file && exit 10
   [ -n "$VERBOSE" ] && echo -n "$file:"
   rsaPubFingerprint2 "$file"
done

# EOF
