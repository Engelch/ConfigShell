#!/usr/bin/env -S bash --norc --noprofile
#
# Install omf (oh-my-fish) and the themes bobthefish and bang-bang (!$ support).
# It stops, it a previous installation is detected, unless '-f' is supplied as an option
#

# set -v
# [ -f "$HOME/.config/fish/default_prompt" ]  && echo delete default_prompt && /bin/rm -fr "$HOME/.config/fish/default_prompt" 

if [ "$1" = -f ] ; then
   echo fish setup
   if [ -d "$HOME/.config/fish" ] ; then
      echo '   moving old fish configuration to ~/.config/fish.old' 
      [ -e "$HOME/.config/fish.old" ] && echo '   removing old fish.old' && /bin/rm -fr "$HOME/.config/fish.old"
      mv "$HOME/.config/fish" "$HOME/.config/fish.old" 
   fi
   [ -e "$HOME/.local/share/omf" ] && \
      echo deleting previous omf installation && \
      /bin/rm -vfr "$HOME/.local/share/omf" | sed 's/^/      /'
else
   [ -e "$HOME/.local/share/omf" ] && \
      echo previous omf installation found, exiting && \
      exit 1 
fi

echo CONFIGSHELL setup..........................
[ ! -d ~/.config/fish ] && echo '    creating ~/.config/fish' && mkdir ~/.config/fish
cd "$HOME/.config/fish" || { 2>&1 echo cannot change to fish configuration directory && exit 2 ; }
/bin/rm -f config.fish
echo '    s-linking config.fish to ConfigShell'
ln -sv /opt/ConfigShell/fish/config.fish . | sed 's/^/      /'
[ ! -d ./functions ] && echo '     creating ./config/fish/functions' && mkdir functions
cd "./functions" || exit 0
echo '    s-linking fish functions'
ln -sv /opt/ConfigShell/fish/functions/* . | sed 's/^/      /'

echo installing omf...
curl https://raw.githubusercontent.com/oh-my-fish/oh-my-fish/master/bin/install | fish
reload
echo '    installing bobthefish'
omf install bobthefish 2>&1 | sed 's/^/      /'
echo '    installing bang-bang'
omf install bang-bang 2>&1 | sed 's/^/      /'


#echo setting default_prompt
#touch "$HOME/.config/fish/default_prompt"
