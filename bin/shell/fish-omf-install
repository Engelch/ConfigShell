#!/usr/bin/env -S bash --norc --noprofile
#
# Install omf (oh-my-fish) and the themes bobthefish and bang-bang (!$ support).
# It stops, it a previous installation is detected, unless '-f' is supplied as an option
#

# set -v
which fish &>/dev/null || { echo fish does not seem to be installed, exiting ; exit 1 ; }

[ -e "$HOME/.local/share/omf" ] && \
   echo Deleting previous omf installation && \
   /bin/rm -fr "$HOME/.local/share/omf"

if [ -d "$HOME/.config/fish/." ] ; then
   # backup old fish installation, overwriting even older ones
   [ -d "$HOME/.config/fish.old/." ] && \
      echo Found old fish configuration "$HOME/.config/fish.old", ovwriting it && \
      /bin/rm -fr "$HOME/.config/fish.old" 
   mv "$HOME/.config/fish"  "$HOME/.config/fish.old" 
fi
mkdir "$HOME/.config/fish"

if [ "$1" = -d -o "$1" = --default ] ; then # no ConfigShell
   echo ============\> NOT installing ConfigShell fish version.
else
   echo Removing default fish configuration
   cd "$HOME/.config/fish/" || { echo cannot jump to fish directory ; exit 2 ; }
   /bin/rm -fr config.fish
   echo Installation of ConfigShell fish configuration
   ln -s /opt/ConfigShell/fish/config.fish .
   [ -d functions/. ] && echo copying functions && cp /opt/ConfigShell/fish/functions/* functions/.
   echo Done.
fi

echo installing omf...
curl https://raw.githubusercontent.com/oh-my-fish/oh-my-fish/master/bin/install | fish
reload

echo installing bobthefish
omf install bobthefish
echo installing bang-bang
omf install bang-bang


#echo setting default_prompt
#touch "$HOME/.config/fish/default_prompt"
